<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Principle Component Analysis | R Notes for Multivariate Analysis</title>
  <meta name="description" content="This is a note for multivariate analysis in R." />
  <meta name="generator" content="bookdown 0.13.2 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Principle Component Analysis | R Notes for Multivariate Analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a note for multivariate analysis in R." />
  <meta name="github-repo" content="liao961120/MVA" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Principle Component Analysis | R Notes for Multivariate Analysis" />
  
  <meta name="twitter:description" content="This is a note for multivariate analysis in R." />
  

<meta name="author" content="Yongfu, Liao" />


<meta name="date" content="2019-09-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="icon-152x152.png" />
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="mvnorm.html"/>
<link rel="next" href="FA.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="libs/viz-0.3/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.1/grViz.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">R Notes for Multivariate Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgement"><i class="fa fa-check"></i>Acknowledgement</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="mvnorm.html"><a href="mvnorm.html"><i class="fa fa-check"></i><b>1</b> Multivariate Normal Distribution &amp; Covariance Matrix</a><ul>
<li class="chapter" data-level="1.1" data-path="mvnorm.html"><a href="mvnorm.html#bivariate-normal-contour-map"><i class="fa fa-check"></i><b>1.1</b> Bivariate Normal Contour Map</a><ul>
<li class="chapter" data-level="1.1.1" data-path="mvnorm.html"><a href="mvnorm.html#ellipse"><i class="fa fa-check"></i><b>1.1.1</b> <code>ellipse()</code></a></li>
<li class="chapter" data-level="1.1.2" data-path="mvnorm.html"><a href="mvnorm.html#data-generation"><i class="fa fa-check"></i><b>1.1.2</b> Data Generation</a></li>
<li class="chapter" data-level="1.1.3" data-path="mvnorm.html"><a href="mvnorm.html#plotting"><i class="fa fa-check"></i><b>1.1.3</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="mvnorm.html"><a href="mvnorm.html#multivariate-normal-functions"><i class="fa fa-check"></i><b>1.2</b> Multivariate Normal Functions</a><ul>
<li class="chapter" data-level="1.2.1" data-path="mvnorm.html"><a href="mvnorm.html#generate-density-fx"><i class="fa fa-check"></i><b>1.2.1</b> Generate density f(x)</a></li>
<li class="chapter" data-level="1.2.2" data-path="mvnorm.html"><a href="mvnorm.html#covariance-matrix"><i class="fa fa-check"></i><b>1.2.2</b> Covariance Matrix</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="PCA.html"><a href="PCA.html"><i class="fa fa-check"></i><b>2</b> Principle Component Analysis</a><ul>
<li class="chapter" data-level="2.1" data-path="PCA.html"><a href="PCA.html#workflow-of-pca"><i class="fa fa-check"></i><b>2.1</b> Workflow of PCA</a><ul>
<li class="chapter" data-level="2.1.1" data-path="PCA.html"><a href="PCA.html#conceptual"><i class="fa fa-check"></i><b>2.1.1</b> Conceptual</a></li>
<li class="chapter" data-level="2.1.2" data-path="PCA.html"><a href="PCA.html#computational-with-r"><i class="fa fa-check"></i><b>2.1.2</b> Computational (with R)</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="PCA.html"><a href="PCA.html#conversion-between-correlation-covaraince-matrices"><i class="fa fa-check"></i><b>2.2</b> Conversion Between Correlation &amp; Covaraince Matrices</a><ul>
<li class="chapter" data-level="2.2.1" data-path="PCA.html"><a href="PCA.html#prcomp"><i class="fa fa-check"></i><b>2.2.1</b> <code>prcomp()</code></a></li>
<li class="chapter" data-level="2.2.2" data-path="PCA.html"><a href="PCA.html#covariance-to-correlation"><i class="fa fa-check"></i><b>2.2.2</b> Covariance to Correlation</a></li>
<li class="chapter" data-level="2.2.3" data-path="PCA.html"><a href="PCA.html#eigen"><i class="fa fa-check"></i><b>2.2.3</b> <code>eigen()</code></a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="PCA.html"><a href="PCA.html#scree-plot"><i class="fa fa-check"></i><b>2.3</b> Scree Plot</a><ul>
<li class="chapter" data-level="2.3.1" data-path="PCA.html"><a href="PCA.html#screeplot-from-base-r"><i class="fa fa-check"></i><b>2.3.1</b> <code>screeplot()</code> from Base R</a></li>
<li class="chapter" data-level="2.3.2" data-path="PCA.html"><a href="PCA.html#fviz_eig-from-factoextra"><i class="fa fa-check"></i><b>2.3.2</b> <code>fviz_eig()</code> from <code>factoextra</code></a></li>
<li class="chapter" data-level="2.3.3" data-path="PCA.html"><a href="PCA.html#customized-function"><i class="fa fa-check"></i><b>2.3.3</b> Customized Function</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="PCA.html"><a href="PCA.html#q-q-plot"><i class="fa fa-check"></i><b>2.4</b> Q-Q Plot</a><ul>
<li class="chapter" data-level="2.4.1" data-path="PCA.html"><a href="PCA.html#qqnorm-from-base-r"><i class="fa fa-check"></i><b>2.4.1</b> <code>qqnorm()</code> from Base R</a></li>
<li class="chapter" data-level="2.4.2" data-path="PCA.html"><a href="PCA.html#self-defined-function"><i class="fa fa-check"></i><b>2.4.2</b> Self-defined Function</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="FA.html"><a href="FA.html"><i class="fa fa-check"></i><b>3</b> Factor Analysis</a><ul>
<li class="chapter" data-level="3.1" data-path="FA.html"><a href="FA.html#the-concept-of-factor-analysis"><i class="fa fa-check"></i><b>3.1</b> The Concept of Factor Analysis</a><ul>
<li class="chapter" data-level="3.1.1" data-path="FA.html"><a href="FA.html#factoring-the-covariance-matrix"><i class="fa fa-check"></i><b>3.1.1</b> Factoring the Covariance Matrix</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="FA.html"><a href="FA.html#principal-component-method"><i class="fa fa-check"></i><b>3.2</b> Principal Component Method</a></li>
<li class="chapter" data-level="3.3" data-path="FA.html"><a href="FA.html#factor-analysis-with-the-psych-package"><i class="fa fa-check"></i><b>3.3</b> Factor Analysis with the <code>psych</code> Package</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="principle-component-method-explained-in-r.html"><a href="principle-component-method-explained-in-r.html"><i class="fa fa-check"></i><b>A</b> Principle Component Method Explained (in R)</a><ul>
<li class="chapter" data-level="A.1" data-path="principle-component-method-explained-in-r.html"><a href="principle-component-method-explained-in-r.html#lambda_i-e_i-of-mathbfs"><i class="fa fa-check"></i><b>A.1</b> <span class="math inline">\(\lambda_i\)</span> &amp; <span class="math inline">\(e_i\)</span> of <span class="math inline">\(\mathbf{S}\)</span></a></li>
<li class="chapter" data-level="A.2" data-path="principle-component-method-explained-in-r.html"><a href="principle-component-method-explained-in-r.html#construction-of-hatmathbfl"><i class="fa fa-check"></i><b>A.2</b> Construction of <span class="math inline">\(\hat{\mathbf{L}}\)</span></a></li>
<li class="chapter" data-level="A.3" data-path="principle-component-method-explained-in-r.html"><a href="principle-component-method-explained-in-r.html#variances-communalities-specific-variances"><i class="fa fa-check"></i><b>A.3</b> Variances: Communalities, &amp; Specific Variances</a><ul>
<li class="chapter" data-level="A.3.1" data-path="principle-component-method-explained-in-r.html"><a href="principle-component-method-explained-in-r.html#specific-variance-psi_i"><i class="fa fa-check"></i><b>A.3.1</b> Specific variance <span class="math inline">\(\psi_i\)</span></a></li>
<li class="chapter" data-level="A.3.2" data-path="principle-component-method-explained-in-r.html"><a href="principle-component-method-explained-in-r.html#proportion-of-variance-due-to-factors"><i class="fa fa-check"></i><b>A.3.2</b> Proportion of variance due to Factors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>Package Used</a></li>
<li class="divider"></li>
<li></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Notes for Multivariate Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
\(
\newcommand{\bm}[1]{\boldsymbol{\mathbf{#1}}}
\)
<div id="PCA" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Principle Component Analysis</h1>
<div id="workflow-of-pca" class="section level2">
<h2><span class="header-section-number">2.1</span> Workflow of PCA</h2>
<div id="conceptual" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Conceptual</h3>
<div id="htmlwidget-f0ae316731eddf2021b1" style="width:480px;height:288px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-f0ae316731eddf2021b1">{"x":{"diagram":"\ndigraph { //non-directed graph\n      graph [layout = dot]  //layout = dot|neato|twopi|circo|fdp\n      rankdir=TB    // TB|RL|LR, LR: Left to Right orientation\n\n      node [shape = box,\n      style = filled,  margin=0.3]\n      \n      node [fillcolor = gray]\n      data [label = \"Data\"]\n      \n      node [fillcolor = orange1]  //orange1-4\n      cov [label = \"Cov Matrix\"]\n      eigen [label = \"Eigenvalue & Eigenvector\"]\n      PC [label = \"Principle Components\" fillcolor = OrangeRed]\n      \n      edge [color = grey3, arrowhead = normal, arrowtail = none]\n      cov -> eigen [label=\"Compute\"]\n      \n      edge [color = grey, arrowhead = normal, arrowtail = none]\n      data -> cov [label=\"Compute\"]\n      data -> eigen [label=\"Input\"]\n      eigen -> PC [label=\"Rotate\"]\n}\n\n      ","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="computational-with-r" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Computational (with R)</h3>
<div id="htmlwidget-1d526e3c4175792351ca" style="width:480px;height:288px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-1d526e3c4175792351ca">{"x":{"diagram":"\ndigraph { //non-directed graph\n      graph [layout = dot]  //layout = dot|neato|twopi|circo|fdp\n      rankdir=TB    // TB|RL|LR, LR: Left to Right orientation\n\n      node [shape = box,\n      style = filled,  margin=0.18]\n      \n      node [fillcolor = gray]\n      data [label = \"Data\"]\n      PC [label = \"Principle Components\" fillcolor = OrangeRed]\n      \n      node [fillcolor = WhiteSmoke, shape = oval]  //orange1-4\n      sdev [label = \"sdev: std of PCs\"]\n      rotation [label = \"rotation: Loading of PCs on origin vars\"]\n      x [label = \"x: Rotated Data\"]\n\n      node [fillcolor = Gold, shape = box]\n      Scree [label = \"Scree Plot\"]\n      Interpret [label = \"Interpret grouping of vars\"]\n      QQplot [label = \"Q-Q Plot: Single PC\"]\n      scatter [label = \"Scatter Plot of 2 PCs\"]\n      \n      edge [color = Darkgray, arrowhead = normal, arrowtail = none]\n      data -> PC [label=\"prcomp()\"]\n      sdev -> Scree [label = \"factoextra::fviz_eig()\"]\n      rotation -> Interpret\n      x -> {QQplot scatter}\n\n      edge [style=dashed, color = grey, arrowhead = none, arrowtail = none]\n      PC -> {sdev rotation x}\n}\n\n      ","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<ul>
<li>Note: <code>sdev</code> of <code>prcomp()</code> are <strong>Standard Deviations</strong>. To get the eigenvalues of the covariance (correlation) matrix, or equivalently, variances of the principle components, you need to <strong>square <code>sdev</code></strong>.</li>
</ul>
</div>
</div>
<div id="conversion-between-correlation-covaraince-matrices" class="section level2">
<h2><span class="header-section-number">2.2</span> Conversion Between Correlation &amp; Covaraince Matrices</h2>
<div id="prcomp" class="section level3">
<h3><span class="header-section-number">2.2.1</span> <code>prcomp()</code></h3>
<p>The function <code>prcomp()</code> in base R <code>stats</code> package performs principle component analysis to input <code>data.frame</code>(with observations as rows and variables as columns), but it returns neither covariance nor correlation matrix. You can compute them directly by passing <code>data.frame</code> to <code>cor()</code> and <code>cov()</code> directly in R without any additional package.</p>

<div class="bs-callout bs-callout-warning">
<p><span class="callout-warning-head">prcomp() vs. princomp()</span></p>
There is another function, <code>princomp()</code>, in <code>stats</code> that performs PCA. This function is based on spectral decomposition<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> while <code>prcomp()</code> is based on SVD<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>. SVD has greater numeric accuracy, so <code>prcomp()</code> is preferred.
</div>

</div>
<div id="covariance-to-correlation" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Covariance to Correlation</h3>
<p>Sometimes there is no raw data but only covariance or correlation matrix, and you may want to convert one to another. This can be done by using simple matrix multiplication, based on the fact that</p>
<p><span class="math display" id="eq:cov2cor">\[\mathbf{R} = diag(\mathbf{S})^{\frac{-1}{2}} ~ \mathbf{S} ~ diag(\mathbf{S})^{\frac{-1}{2}}
\tag{2.1}\]</span></p>
<p>, where <span class="math inline">\(\mathbf{R}\)</span> is the correlation matrix, <span class="math inline">\(\mathbf{S}\)</span> is the covariance matrix, and <span class="math inline">\(diag(\mathbf{S})\)</span> is the diagonal matrix composed of diagonal elements of <span class="math inline">\(\mathbf{S}\)</span>.</p>
</div>
<div id="eigen" class="section level3">
<h3><span class="header-section-number">2.2.3</span> <code>eigen()</code></h3>
<p>After obtaining the covariance or correlation matrix, direct computation of eigenvalue and eigenvectors is straightforward: pass the matrix to base R <code>eigen()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cov</span>(iris[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">eigen</span>()</code></pre></div>
<pre><code>eigen() decomposition
$values
[1] 3.69111979 0.24137727 0.05945372

$vectors
            [,1]       [,2]       [,3]
[1,]  0.38983343  0.6392233 -0.6628903
[2,] -0.09100801  0.7430587  0.6630093
[3,]  0.91637735 -0.1981349  0.3478435</code></pre>
</div>
</div>
<div id="scree-plot" class="section level2">
<h2><span class="header-section-number">2.3</span> Scree Plot</h2>
<p>Scree plot is an important tool for determining the importance of principle components. Although the logic of plotting scree plots is easy, it may be quite annoying for repeating the code every time.</p>
<div id="screeplot-from-base-r" class="section level3">
<h3><span class="header-section-number">2.3.1</span> <code>screeplot()</code> from Base R</h3>
<p>There is a ready-written function for scree plot in <code>stats</code> package, but the output is terrible:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prcomp</span>(iris[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">screeplot</span>(<span class="dt">type=</span><span class="st">&quot;lines&quot;</span>)</code></pre></div>
<p><img src="Notes_files/figure-html/unnamed-chunk-13-1.svg" width="480" /></p>
</div>
<div id="fviz_eig-from-factoextra" class="section level3">
<h3><span class="header-section-number">2.3.2</span> <code>fviz_eig()</code> from <code>factoextra</code></h3>
<p>For a better-looking scree plot function, I recommend <code>fviz_eig()</code> from <code>factoextra</code> <span class="citation">(Kassambara and Mundt <a href="#ref-R-factoextra">2017</a>)</span>. <code>fviz_eig()</code> has better looking outputs and more customizable plotting parameters, and since it is based on <code>ggplot2</code>, you can actually enhance it with the <code>ggplot2</code> syntax: <code>+</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(factoextra)
<span class="kw">prcomp</span>(iris[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fviz_eig</span>()</code></pre></div>
<p><img src="Notes_files/figure-html/unnamed-chunk-14-1.svg" width="480" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prcomp</span>(iris[,<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">fviz_eig</span>(<span class="dt">choice =</span> <span class="st">&quot;eigenvalue&quot;</span>, <span class="co"># y as eigenvalue</span>
             <span class="dt">geom =</span> <span class="st">&quot;line&quot;</span>,
             <span class="dt">addlabels =</span> T) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>))</code></pre></div>
<p><img src="Notes_files/figure-html/unnamed-chunk-15-1.svg" width="480" /></p>
</div>
<div id="customized-function" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Customized Function</h3>
<p>I have OCD with plotting, so not completely satisfied with <code>factoextra::fviz_eig()</code>. So I created my own <code>scree_plot()</code> by building on <code>fviz_eig()</code><a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a>, which supports <strong>double y-axis</strong>: one showing eigenvalue, the other proportion of total variance explained.</p>
</div>
</div>
<div id="q-q-plot" class="section level2">
<h2><span class="header-section-number">2.4</span> Q-Q Plot</h2>
<p>Q-Q plots are for checking the normality assumuption and are also useful for detecting outlyers. Principle components are linear combinations of the original variables, so if the original variables come from a multivariate normal distribution, principle components are expected to have normal distributions.</p>
<div id="qqnorm-from-base-r" class="section level3">
<h3><span class="header-section-number">2.4.1</span> <code>qqnorm()</code> from Base R</h3>
<p>There is also a base R <code>qqnorm()</code> function, which plots sample quantiles against theoretical quantiles obtain from the standard normal distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prcomp</span>(iris[<span class="dv">1</span><span class="op">:</span><span class="dv">60</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])[[<span class="st">&quot;x&quot;</span>]][,<span class="dv">1</span>] <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">qqnorm</span>()</code></pre></div>
<p><img src="Notes_files/figure-html/unnamed-chunk-16-1.svg" width="480" /></p>
<p><code>prcomp(data.frame)[[&quot;x&quot;]]</code> returns the principle component scores, i.e. data that are <strong>rotated</strong> or <strong>weighted</strong> by the elements of the eigenvectors.</p>
<p><code>prcomp(data.frame)[[&quot;x&quot;]][,1]</code> subsets the first column of the principle component scores, which is the scores of the First principle component, i.e. data weighted according to elements of the first (corresponding to the largest eigenvalue) eigenvector.</p>
</div>
<div id="self-defined-function" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Self-defined Function</h3>
<p><code>qqnorm()</code> is pretty good but lacks one important feature: <strong>labeling points on the Q-Q plot so that identification of the points is possible</strong>.</p>
<p>So I wrote my own function <code>QQplot</code>, which labels every point on the graph:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">QQplot &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">ID=</span><span class="st">&quot;none&quot;</span>, 
                   <span class="dt">theme=</span><span class="ot">NULL</span>, <span class="dt">color=</span><span class="st">&quot;red&quot;</span>, <span class="dt">text=</span><span class="ot">TRUE</span>,
                   <span class="dt">text_adj=</span>
                       <span class="kw">c</span>(<span class="dt">hjust=</span><span class="op">-</span><span class="fl">0.1</span>, <span class="dt">vjust=</span><span class="dv">0</span>, <span class="dt">size=</span><span class="dv">3</span>)) {
    <span class="kw">library</span>(dplyr)
    <span class="kw">library</span>(ggplot2)
    
    x &lt;-<span class="st"> </span><span class="kw">as_data_frame</span>(x) 
    n &lt;-<span class="st"> </span><span class="kw">nrow</span>(x)
    quantiles &lt;-<span class="st"> </span><span class="kw">qnorm</span>(<span class="dt">p=</span><span class="kw">seq</span>(<span class="fl">0.5</span><span class="op">/</span>n, <span class="dv">1</span><span class="op">-</span><span class="fl">0.5</span><span class="op">/</span>n, <span class="dv">1</span><span class="op">/</span>n))
    
    <span class="cf">if</span> (ID <span class="op">==</span><span class="st"> &quot;none&quot;</span>) { <span class="co"># assign ID if not passed</span>
        ID &lt;-<span class="st"> </span><span class="kw">as.character</span>(<span class="dv">1</span><span class="op">:</span>n)
    } <span class="cf">else</span> {
        ID &lt;-<span class="st"> </span><span class="kw">as_data_frame</span>(ID)
        ID &lt;-<span class="st"> </span><span class="kw">as.character</span>(ID[[<span class="kw">colnames</span>(ID)]])
        }
    
    <span class="cf">if</span> (text <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) {
        text &lt;-<span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label=</span>ID),
                              <span class="dt">hjust=</span>text_adj[<span class="dv">1</span>],
                              <span class="dt">vjust=</span>text_adj[<span class="dv">2</span>],
                              <span class="dt">size =</span> text_adj[<span class="dv">3</span>])
    } <span class="cf">else</span> {text &lt;-<span class="st"> </span><span class="ot">NULL</span>}
    
    data &lt;-<span class="st"> </span><span class="kw">cbind</span>(ID, x)
    <span class="kw">colnames</span>(data) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;x&quot;</span>)
    data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(x) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">quantile=</span>quantiles)
    
    pl &lt;-<span class="st"> </span><span class="kw">ggplot</span>(data, <span class="kw">aes</span>(<span class="dt">x=</span>quantiles, <span class="dt">y=</span>x))<span class="op">+</span>
<span class="st">        </span><span class="kw">geom_point</span>(<span class="dt">color=</span>color)<span class="op">+</span>
<span class="st">        </span>text <span class="op">+</span><span class="st"> </span>theme <span class="op">+</span>
<span class="st">        </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Theoretical Quantile&quot;</span>,
             <span class="dt">y=</span><span class="st">&quot;x&quot;</span>,
             <span class="dt">title=</span><span class="st">&quot;Q-Q Plot&quot;</span>)
    pl
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prcomp</span>(iris[<span class="dv">1</span><span class="op">:</span><span class="dv">60</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])[[<span class="st">&quot;x&quot;</span>]][,<span class="dv">1</span>] <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">QQplot</span>()</code></pre></div>
<p><img src="Notes_files/figure-html/unnamed-chunk-18-1.svg" width="480" /></p>
<!-- FootNotes -->

</div>
</div>
</div>
<h3>Package Used</h3>
<div id="refs" class="references">
<div id="ref-R-factoextra">
<p>Kassambara, Alboukadel, and Fabian Mundt. 2017. <em>Factoextra: Extract and Visualize the Results of Multivariate Data Analyses</em>. <a href="https://CRAN.R-project.org/package=factoextra" class="uri">https://CRAN.R-project.org/package=factoextra</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>The Conceptual workflow of PCA at Section <a href="PCA.html#conceptual">2.1.1</a> is based on spectral decomposition.<a href="PCA.html#fnref1">↩</a></p></li>
<li id="fn2"><p>You can check the answers at <a href="https://stats.stackexchange.com/questions/20101/what-is-the-difference-between-r-functions-prcomp-and-princomp" target="_blank">Stack Overflow</a><a href="PCA.html#fnref2">↩</a></p></li>
<li id="fn3"><p>Check <a href="https://github.com/liao961120/local_depend/blob/master/R%20functions/multivariate_fc.R" target="_blank"><code>multivariate_fc.R</code></a>, starting at line 46.<a href="PCA.html#fnref3">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mvnorm.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="FA.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/liao961120/MVA/edit/master/PCA.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
